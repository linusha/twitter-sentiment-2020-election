---
title: "HICSS Iteration 2"
author: "Linus Hagemann"
date: "June 7, 2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(stargazer)
library(MASS)
library(stringr)
library(qdap)
library(DataExplorer)
library(sylcount)
```

```{r include=FALSE}
# including the liwc for original tweets
tweet_data <- read.csv('complete_data.csv')
# liwc for cleaned tweets
clean_tweet_liwc <- read.csv('clean_tweets_liwc.csv')
# famous and famous level
famous <- read.csv('tweets_famous.csv')
tweet_data$X <- NULL
tweet_data$X.1 <- NULL
tweet_data$Analytic <- NULL
tweet_data$Clout <- NULL
tweet_data$Authentic <- NULL
tweet_data$Tone <- NULL
tweet_data <- tweet_data[,1:40]
tweet_data$WPS <- NULL
tweet_data$Sixltr <- NULL
tweet_data$Dic <- NULL
tweet_data$function. <- NULL

famous$X <- NULL
tweet_data <- cbind(tweet_data, famous)

clean_tweet_liwc$A <- NULL
clean_tweet_liwc$B <- NULL
colnames(clean_tweet_liwc) <- paste0("cleanLIWC_", colnames(clean_tweet_liwc))

tweet_data <- cbind(tweet_data, clean_tweet_liwc)
```

```{r}
# TODO: data explorer visual analytics
```


Overall size of our sample: `r nrow(tweet_data)` tweets.

We will work with the sentiment scores of the `clean_tweet`s I scraped. The following preprocessing has occured on that:

- Beginning with the original tweet
- content of the tweet has been converted to lower case
- all urls, hashtags (#) and e-mail adresses has been removed
- the actual words of the hashtags have been preserved (e.g. *#Biden* now reads *biden*).

Since we use this variable all SentiStrength Variables that we use going further have been prefixed with `ct_` for 'clean tweets'.

# Creation of new Features

We create new dummy features whether a tweet was:

- replied to
- commented on
- liked.

The numerical counts are already available as parts of the scraped data.

```{r}
tweet_data$liked <- ifelse(tweet_data$likes != 0, TRUE, FALSE)
tweet_data$retweeted <- ifelse(tweet_data$retweets != 0, TRUE, FALSE)
tweet_data$repliedTo <- ifelse(tweet_data$replies != 0, TRUE, FALSE)
# keep the "salad" dummy, just because I am interested whether one can read more from it
# when comparing to the new models
tweet_data$engaged <- ifelse(
  (tweet_data$repliedTo + tweet_data$retweeted + tweet_data$liked) > 0,
  TRUE,
  FALSE
  )
```

## Count of Present Hashtags in a Tweet

```{r}
# we just assume the number of # to be equal to the number of hashtags
# is just a heuristic, but with only 280 character/tweet and over 3 million tweets
# this should be reasonable in grand scheme of things
# we need to base this on the original tweet, since otherwise the # are already removed
tweet_data$hashtagCount <- lapply(tweet_data$original_tweet, stringr::str_count, pattern = '#')
```

## Length of Tweet in Characters

```{r}
# will be again based on the original tweet, since that is what user users saw and interacted with
tweet_data$charLength <- lapply(tweet_data$original_tweet, nchar)
```

## Positive Interaction Term

From the code that was initially thought to be used to replicate Stieglitz, we already have an interaction term in our data.
It is defined to be $negative \times sentiment$.

Rename it to avoid confusion and create the positive interaction term as well:

```{r}
tweet_data$ct_negative_interaction <- tweet_data$ct_interactionTerm
tweet_data$ct_positive_interaction <- tweet_data$ct_sentiment * tweet_data$ct_positiveScore
```

## Mirror negative score to be easier to interpre

```{r}
tweet_data$ct_negativeScoreToUse <- tweet_data$ct_negativeScore * -1
```

## Flesch Reading Ease

```{r}
tweet_data$syllables <- sapply(sylcount(tweet_data$clean_tweet), sum)
tweet_data$sentences <- round(tweet_data$cleanLIWC_WC / tweet_data$cleanLIWC_WPS)
tweet_data$flesch <- 206.835 - 1.015 * (tweet_data$cleanLIWC_WC / tweet_data$sentences) - 84.6 * (tweet_data$syllables / tweet_data$cleanLIWC_WC)
tweet_data$hashtagCount <- sapply(tweet_data$hashtagCount, sum)
tweet_data$charLength <- sapply(tweet_data$charLength, sum)
write.csv(tweet_data, "final_data.csv")
```


# Investigation of crass outliers in our target variables

```{r}
hist(tweet_data[tweet_data$likes>0])
```


# Modelling

Here is a list of all features used in the following modelling:

|           Name          |                                Description                               |          Comment         |
|:-----------------------:|:------------------------------------------------------------------------:|:------------------------:|
|        retweeted        |                                TRUE/FALSE                                |                          |
|         retweets        |                            Number of Retweets                            |                          |
|        repliedTo        |                                TRUE/FALSE                                |                          |
|         replies         |                             Number of Replies                            |                          |
|          liked          |                                TRUE/FALSE                                |                          |
|          likes          |                              Number of Likes                             |                          |
|         hashtags        |                                TRUE/FALSE                                |                          |
|       hashtagCount      |                        Number of Hashtags in Tweet                       |                          |
|           url           |                                TRUE/FALSE                                |                          |
|            WC           |              Length of tweet as it appeared online in words              |           LIWC           |
|        charLength       |            Length of tweet as it appeared online in characters           |                          |
| ct_negative_interaction |      Based on SentiStrength, ((positive - negative) - 2) * negative      | SentiStrenght, Stieglitz |
| ct_positive_interaction |      Based on SentiStrength, ((positive - positive) - 2) * positive      | SentiStrenght, Stieglitz |
|     ct_negativeScore    |                                                                          |       SentiStrength      |
|     ct_positiveScore    |                                                                          |       SentiStrength      |
|            i            |                                                                          |           LIWC           |
|            we           |                                                                          |           LIWC           |
|           they          |                                                                          |           LIWC           |
|      user_activity      | Amount of tweets user made in the timeframe in which we collected tweets |  also done by Stieglitz  |


## Modelling Binary Targets

Using logistic regression.

### Commented

```{r}
stargazer(glm(repliedTo ~ hashtags + hashtagCount + 
                url + 
                WC + charLength
                ct_negative_interaction + ct_positive_interaction +
                ct_negativeScore + ct_positiveScore +
                i + we + they,
    data = tweet_data,
    family = binomial(link = 'logit')), type = 'text')
```

### Liked

### Replied To


## Modelling Count Targets

Using a negative binomial regression as our dependent variable is a count.

### Comments

### Likes

### Retweets
